name: cbfsubarray
function: cbf-subarray-observation
domain: subarray
command: "CbfSubarray"
instances: ["cbfsubarray"]
depends_on:
  - device: sys/database/2
readinessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3
livenessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3
server:
  name: "CbfSubarray"
  instances:
  - name: "cbfsubarray"
    classes:
    - name: "CbfSubarray"
      devices:
      {{ $count := (.Values.num_subarrays | int) }}
      {{- range $i, $e := until $count }}
      - name: "mid_csp_cbf/sub_elt/subarray_0{{ add1 $i }}"
        properties:
          - name: "CbfControllerAddress"
            values:
            - "mid_csp_cbf/sub_elt/controller"
          - name: "FSP"
            values:
            - "mid_csp_cbf/fsp/01"
            - "mid_csp_cbf/fsp/02"
            - "mid_csp_cbf/fsp/03"
            - "mid_csp_cbf/fsp/04"
          - name: "FspCorrSubarray"
            values:
            - "mid_csp_cbf/fspCorrSubarray/01_0{{ add1 $i }}"
            - "mid_csp_cbf/fspCorrSubarray/02_0{{ add1 $i }}"
            - "mid_csp_cbf/fspCorrSubarray/03_0{{ add1 $i }}"
            - "mid_csp_cbf/fspCorrSubarray/04_0{{ add1 $i }}"
          - name: "SubID"
            values:
            - "1"
          - name: "VCC"
            values:
            - "mid_csp_cbf/vcc/001"
            - "mid_csp_cbf/vcc/002"
            - "mid_csp_cbf/vcc/003"
            - "mid_csp_cbf/vcc/004"
          - name: "TalonBoard"
            values:
            - "mid_csp_cbf/talon_board/001"
            - "mid_csp_cbf/talon_board/002"
            - "mid_csp_cbf/talon_board/003"
            - "mid_csp_cbf/talon_board/004"
            - "mid_csp_cbf/talon_board/005"
            - "mid_csp_cbf/talon_board/006"
            - "mid_csp_cbf/talon_board/007"
            - "mid_csp_cbf/talon_board/008"
          - name: "VisSLIM"
            values:
            - "mid_csp_cbf/slim/slim-vis"
      {{- end}}
image:
  registry: "{{.Values.midcbf.image.registry}}"
  image: "{{.Values.midcbf.image.image}}"
  tag: "{{.Values.midcbf.image.tag}}"
  pullPolicy: "{{.Values.midcbf.image.pullPolicy}}"
